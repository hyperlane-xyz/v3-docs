# Hyperlane æœ¬åœ°è®¾ç½®æŒ‡å—ï¼šåœ¨ Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€æ¶ˆæ¯

æœ¬æŒ‡å—å°†æŒ‡å¯¼ä½ ä½¿ç”¨ Hyperlane CLI åœ¨ä¸¤ä¸ªæœ¬åœ° Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€è·¨é“¾æ¶ˆæ¯ã€‚

## å‰ææ¡ä»¶

- **[Hyperlane CLI](https://docs.hyperlane.xyz/docs/reference/cli)ï¼š** ç¡®ä¿ä½ å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Hyperlane CLIã€‚

  ```bash
  npm install -g @hyperlane-xyz/cli
  ```

- **[Anvil (foundry)](https://book.getfoundry.sh/getting-started/installation)ï¼š** ç”¨äºè¿è¡Œæœ¬åœ°é“¾ã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
  ```bash
  curl -L https://foundry.paradigm.xyz | bash
  ```
- **Node.js**ï¼ˆv18 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- **éƒ¨ç½²é’±åŒ…ç§é’¥**ï¼šä½ éœ€è¦ä¸€ä¸ªæœ‰èµ„é‡‘çš„é’±åŒ…æ¥éƒ¨ç½²åˆçº¦ã€‚è¿™å°†ä½œä¸º HYP_KEY ä½¿ç”¨ã€‚
  ```bash
  export HYP_KEY=<ä½ çš„ç§é’¥>
  ```

## åˆ†æ­¥æŒ‡å—

### 1. ç¯å¢ƒè®¾ç½®ï¼šåˆ›å»º Hyperlane é…ç½®çš„å·¥ä½œç›®å½•ï¼š

```bash
mkdir hyperlane-local-test && cd hyperlane-local-test
```

### 2. å¯åŠ¨ä¸¤ä¸ªä¸åŒçš„ Anvil èŠ‚ç‚¹

æˆ‘ä»¬å°†è¿è¡Œä¸¤ä¸ªå…·æœ‰å”¯ä¸€é“¾ ID çš„ Anvil èŠ‚ç‚¹ã€‚

- åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ª Anvil èŠ‚ç‚¹ï¼š

  ```bash
  anvil --port 8545 --chain-id 31337
  ```

  - è¿è¡Œåœ¨ `http://localhost:8545`
  - é“¾ IDï¼š`31337`

- åœ¨æ–°çš„ç»ˆç«¯ä¸­ï¼Œå¯åŠ¨ç¬¬äºŒä¸ª Anvil èŠ‚ç‚¹ï¼š

  ```bash
  anvil --port 8546 --chain-id 31338
  ```

  - è¿è¡Œåœ¨ `http://localhost:8546`
  - é“¾ IDï¼š`31338`

### 3. åˆå§‹åŒ– Hyperlane æ³¨å†Œè¡¨

åœ¨æ–°çš„ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ Hyperlane CLI ä¸ºä¸¤ä¸ª Anvil èŠ‚ç‚¹åˆ›å»ºé…ç½®ï¼š

```bash
hyperlane registry init
```

æŒ‰ç…§æç¤ºè®¾ç½® `anvilnode1`ã€‚CLI å°†è¯¢é—®ä½ çš„é“¾çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬é“¾ ID å’Œ RPC URLã€‚å¯¹ `anvilnode2` é‡å¤æ­¤è¿‡ç¨‹ã€‚

æ­¤è¿‡ç¨‹å°†åœ¨ `$HOME/.hyperlane/chains/anvilnode1` å’Œ `$HOME/.hyperlane/chains/anvilnode2` ä¸‹åˆ›å»º `metadata.yaml` æ–‡ä»¶ã€‚

ç¤ºä¾‹å…ƒæ•°æ®ï¼š

- **anvilnode1**

```yaml
chainId: 31337
displayName: Anvilnode1
domainId: 31337
isTestnet: true
name: anvilnode1
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8545
```

- **anvilnode2**

```yaml
chainId: 31338
displayName: Anvilnode2
domainId: 31338
isTestnet: true
name: anvilnode2
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8546
```

### 4. éƒ¨ç½²æ ¸å¿ƒåˆçº¦

æˆ‘ä»¬å°†é…ç½®å¹¶éƒ¨ç½² Hyperlane æ ¸å¿ƒåˆçº¦ã€‚

:::tip
ä½ éœ€è¦éƒ¨ç½²é’±åŒ…ç§é’¥æ¥éƒ¨ç½²æ ¸å¿ƒåˆçº¦ã€‚ä½ å¯ä»¥ä½¿ç”¨ `export HYP_KEY='<ä½ çš„ç§é’¥>'` å°†ç§é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚
:::

```bash
hyperlane core init
```

éƒ¨ç½²é…ç½®å°†ä¿å­˜åˆ° `./configs/core-config.yaml`ã€‚

æ¥ä¸‹æ¥ï¼Œéƒ¨ç½²æ ¸å¿ƒåˆçº¦ï¼š

```bash
hyperlane core deploy
```

æŒ‰ç…§æç¤ºé€‰æ‹© `anvilnode1`ã€‚CLI å°†éƒ¨ç½² Mailboxã€è·¨é“¾å®‰å…¨æ¨¡å—ï¼ˆISMï¼‰å’Œå…¶ä»–å¿…éœ€çš„åˆçº¦ã€‚å¯¹ `anvilnode2` é‡å¤æ­¤è¿‡ç¨‹ã€‚

å®Œæˆåï¼Œä½ ä¼šåœ¨ `$HOME/.hyperlane/chains/anvilnode1` å’Œ `$HOME/.hyperlane/chains/anvilnode2` ä¸­æ‰¾åˆ° `addresses.yaml`ï¼Œå…¶ä¸­åŒ…å«å·²éƒ¨ç½²çš„åˆçº¦åœ°å€ã€‚

:::tip
ä½ åº”è¯¥èƒ½å¤Ÿåœ¨è¿è¡Œæœ¬åœ°èŠ‚ç‚¹çš„ç»ˆç«¯ä¸Šçœ‹åˆ°åˆçº¦éƒ¨ç½²çš„æ¶ˆæ¯ã€‚
:::

### 5. å‘é€æµ‹è¯•æ¶ˆæ¯

ä½¿ç”¨ Hyperlane CLI ä» `anvilnode1` å‘ `anvilnode2` å‘é€æ¶ˆæ¯ã€‚

```bash
hyperlane send message --relay
```

CLI å°†æç¤ºä½ æä¾›æºé“¾ï¼ˆ`anvilnode1`ï¼‰å’Œç›®æ ‡é“¾ï¼ˆ`anvilnode2`ï¼‰ã€‚

:::tip

å¯¹äºæœ¬åœ°æµ‹è¯•ï¼Œ`--relay` æ ‡å¿—ä¼šè‡ªåŠ¨å°†æ¶ˆæ¯ä¸­ç»§åˆ°ç›®æ ‡é“¾ã€‚

:::

æŸ¥çœ‹ `anvilnode1` å’Œ `anvilnode2` ä¸Šçš„æ—¥å¿—ï¼Œç¡®è®¤æ¶ˆæ¯å·²å‘é€å’Œæ¥æ”¶ã€‚

ğŸ‰ å°±æ˜¯è¿™æ ·ï¼Œä½ å·²ç»ä½¿ç”¨ Hyperlane åœ¨ä¸¤ä¸ªæœ¬åœ° Anvil èŠ‚ç‚¹ä¹‹é—´å‘é€äº†æ¶ˆæ¯ï¼
