# 监控和告警

验证器在由参数 `--metrics` 指定的端口号上暴露指标。默认端口为 `9090`，但可以选择任何有效的端口。

我们建议使用 Prometheus 来抓取这些指标，并使用 Grafana 来可视化它们，使用[此仪表板 JSON 模板](https://github.com/hyperlane-xyz/hyperlane-monorepo/blob/2f7f714c5b698fedcead9825f52da6ef95f96be1/tools/grafana/validator-dashboard-template.json)，如下所示。这个仪表板的优点是它可以同时显示多个验证器。截图显示了按链或按 kubernetes pod 分组的指标。

![验证器 Grafana 仪表板模板](/img/dashboard-template-validator.png)

:::info

如果以 Docker 镜像方式运行，请确保端口转发指标端点端口。例如，要将本地端口 80 转发到端口 9090，在您的 `docker run` 命令中添加以下标志：`-p 9090:80`

:::

## 指标

仪表板模板包含以下指标。
| 指标                                                                          | 描述                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `hyperlane_latest_checkpoint`                                                   | 验证器观察到的最新检查点，以30分钟增量可视化（"已签名的检查点差异"）。如果尽管 `hyperlane_block_height` 在增加，但该指标不为正，可能意味着要么没有新消息，要么验证器停止签名检查点。                                                                                     |
| `hyperlane_block_height`                                                        | 代理正在使用的 RPC 节点的区块高度，以30分钟增量可视化（"最新区块差异"）。如果此指标不增加，RPC 可能不健康需要更改。                                                                                                                                                                                        |
| `hyperlane_span_events_total{agent="validator", event_level="error"}`           | 记录的错误总数，以30分钟增量可视化（"错误日志计数差异"）。如果该指标在最后一小时内的导数超过1，至少应该发出低严重性警报。请注意，仪表板查询按 kubernetes pod 名称对指标进行分组，因此如果您不在 kubernetes 环境中运行，可能需要调整此查询。                                                         |
| `hyperlane_span_events_total{agent="validator", event_level="warn"}`            | 记录的警告总数，以30分钟增量可视化（"警告日志计数差异"）。如果该指标在最后一小时内的导数超过1，至少应该发出低严重性警报。请注意，仪表板查询按 kubernetes pod 名称对指标进行分组，因此如果您不在 kubernetes 环境中运行，可能需要调整此查询。                                                      |

## 告警
上述所有指标都可以组合使用来创建最小化误报的告警。一些关键告警示例：
- 在过去6小时内，`hyperlane_latest_checkpoint` 停止增加，但 `hyperlane_block_height` 仍在增加，且 `error` 和 `warn` 日志计数也在增加
- `hyperlane_block_height` 在过去30分钟内没有增加

如果您收到告警，请务必检查日志以确定可能的问题所在。
