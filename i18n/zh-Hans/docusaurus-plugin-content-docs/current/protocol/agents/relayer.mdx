# 中继器

## 概述

### 核心功能

中继器运行 Hyperlane 协议的传输层，负责将消息从源链传递到目标链。根据接收方指定的[跨链安全模块 (ISM)](../../reference/ISM/specify-your-ISM)，可能需要元数据来证明消息的安全性，例如用于[多重签名 ISM](../ISM/multisig-ISM.mdx)的验证者签名、默克尔证明、零知识证明等。因此，在尝试传递之前，中继器会收集任何 ISM 特定的元数据。

:::tip
中继器将定期重试元数据收集和消息提交。这对于提高对各种中断的恢复能力很重要，比如：没有支付传递的 gas 费用、中继器余额不足、目标链上交易费用临时激增、验证者停机等情况。
:::

### 中继器激励

消息发送者在源链上支付传递费用，中继器运营者有责任将收入重新平衡到目标链账户，以便始终能够支付传递交易费用。中继器不会从协议中直接获得代币激励，但运营者可以为其提供的关键服务配置费用结构。更多信息，请查看[跨链 Gas 支付 (IGPs)](../interchain-gas-payment.mdx)。

### 运行中继器

中继器可以轻松配置他们希望处理的消息。目前，中继器将支持：

1. 发送者/接收者白名单。
2. 发送者/接收者黑名单。
3. 能够接受[源链上的支付](../../reference/messaging/send.mdx#quote-dispatch)以处理目标链上的消息。

虽然运行是无需许可的，但由消息发送者来选择支付哪个中继器进行传递。[邮箱](../mailbox.mdx)集成通常默认总是支付同一个中继器，但消息发送者可以选择退出。为了方便起见，Hyperlane 将运行一个开源且可配置的中继器代理，以 Rust 二进制文件的形式实现。如果您想运行自己的中继器，我们已经开源了[二进制文件](https://github.com/hyperlane-xyz/hyperlane-monorepo/tree/main/rust/main/agents/relayer)。

运行自己的中继器涉及部署一个 [IGP 合约](../interchain-gas-payment.mdx)并在其中维护代币汇率和 gas 价格，以准确收取消息传递费用。

:::info
想要运行中继器？请参考[中继器](../../operate/relayer/run-relayer.mdx)指南。
:::

## 更多细节

中继器由两个主要任务组成：每个源链的索引器和每个目标链的提交器。

![高级中继器架构](/img/relayer-architecture-high-level.png)

### 索引器

通过使用 RPC 查询[邮箱](../mailbox.mdx)合约事件来索引新的和历史消息。同时也会索引[gas 支付](../interchain-gas-payment.mdx)以确认发送者支付了传递费用，某些 ISM 使用额外的源链数据。这种情况适用于多重签名 ISM，它依赖 Merkle Tree Hook 合约来告知中继器哪个验证者签名对应哪个消息。每种事件类型（消息、IGP、Merkle Tree 插入）都会生成一个独立的索引任务。

索引器将数据写入本地数据库（RocksDB）作为缓存，并与提交器任务通信 - 后者定期轮询数据库以检查是否有新消息被调度。
