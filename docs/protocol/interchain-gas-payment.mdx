# Interchain Gas Payments

Successful interchain messages require two transactions; one on the origin chain to send the message, and one on the destination chain to deliver the message.

For convenience, Hyperlane provides an onchain interface on the origin chain that allows message senders to pay [fees](#interchain-gas-payment-calculation) to the [relayer](./agents/relayer.mdx) to deliver a message on the destination chain. This payment is called an **interchain gas payment**.

```mermaid
flowchart LR
    subgraph Origin Chain
      Sender
      M_O[(Mailbox)]
      IGP[InterchainGasPaymaster]
      Sender -- "dispatch(...)<br>{value}" --> M_O
      M_O -- "postDispatch(..., gasLimit)<br>{value}" --> IGP
    end

    Relayer((Relayer))

    M_O -. "indexing" .-> Relayer
    IGP -. "value" .- Relayer

    subgraph Destination Chain
      M_D[(Mailbox)]
      M_D -- "handle(...)" --> Recipient
    end

    Relayer -- "process{gasLimit}(...)" --> M_D
```

## Interchain Gas Payment Process

To [deliver a message](../reference/messaging/receive.mdx), a transaction must be included on the destination chain that calls the Mailbox `process` function with the encoded message and ISM metadata.

```mermaid
flowchart LR
    subgraph Origin Chain
      Sender
      M_O[(Mailbox)]
      IGP[InterchainGasPaymaster]
      Sender -- "dispatch(...)<br>{value}" --> M_O
      M_O -- "postDispatch(..., gasLimit)<br>{value}" --> IGP
    end

    Relayer((Relayer))

    M_O -. "indexing" .-> Relayer
    IGP -. "value" .- Relayer
```

For convenience, a [relayer](../operate/relayer/run-relayer.mdx) watches for dispatched messages and will submit process transactions on behalf of the message sender if they receive sufficient payment on the origin chain. This is the _interchain gas payment_.

```mermaid
flowchart LR
    Relayer((Relayer))

    subgraph Destination Chain
      M_D[(Mailbox)]
      M_D -- "handle(...)" --> Recipient
    end

    Relayer -- "process{gasLimit}(...)" --> M_D
```

Because messages can trigger arbitrary code execution, the relayer must meter the [`handle` call](../reference/messaging/receive.mdx#handle) with a `gasLimit` to charge appropriately at message dispatch time.

## InterchainGasPaymasters

Interchain gas payments are facilitated by `InterchainGasPaymaster` (IGP) smart contracts.

These contracts expose the [InterchainGasPaymaster interface](../reference/hooks/interchain-gas.mdx), which allow message senders to pay the [relayer](./agents/relayer.mdx) with native tokens on the origin chain to cover the costs of delivering a message on the destination chain.

Each `InterchainGasPaymaster` contract corresponds to exactly one relayer. You can find addresses of the Abacus Works' relayer under [addresses](../reference/contract-addresses.mdx).

### Interchain Gas Payment Calculation

The interchain gas payment is calculated as follows:

$$
destinationTxCost = destinationGasPrice * gasLimit
\\[5pt]
exchangeRate = \frac{originGasTokenPrice}{destinationGasTokenPrice}
\\[5pt]
originFee = exchangeRate * destinationTxCost
$$

The `gasLimit` and the `exchangeRate` are configured by the message sender and the relayer, respectively.

## Trust Assumptions

Interchain gas payments are based on a social contract between the message sender and relayer. In other words, a relayer may receive interchain gas payments without delivering the corresponding messages. Therefore, when making interchain gas payments, it is recommended to use an IGP contract that is associated with a known and reputable relayer.

An honest relayer implementation will honor any successful gas payments made to its IGP, no matter how many tokens were actually paid. By keeping [gas oracles](../reference/hooks/interchain-gas.mdx) up to date, the relayer can ensure that gas payments succeed if and only if a "fair" price was paid.

There are no trust assumptions with respect to relayers in the Hyperlane protocol, and under no circumstances will a malicious relayer be able to censor or falsify messages. The worst thing that a relayer can do is accept payments without delivering a message.

## Learn More

- For details on gas limit calculations, benchmarking recommendations, gas oracles, and destination gas configuration, refer to [Interchain Gas Payment Details](../reference/hooks/interchain-gas.mdx).
- For relayer setups and implementation guidance, see the [relayer](./agents/relayer.mdx) section.
