设置好部署器、验证器和中继器密钥后，就可以使用 Hyperlane CLI 将智能合约部署到本地和远程链上了。

在本地链上，我们将进行部署：

- 核心合约，包括可用于发送和接收信息的[Mailbox](/docs/reference/messaging/messaging-interface)。

我们在所有链将进行部署：

- 可用于验证来自其他本地和远程链的入站消息的 Multisig ISM。
- `InterchainGasPaymaster`可用于支付中继器传递链间消息的费用。
- `TestRecipient`我们将向其发送信息，以测试一切工作是否正常。

### 设置

首先，使用NPM 安装 [Hyperlane CLI](https://www.npmjs.com/package/@hyperlane-xyz/cli)。需要 [Node 16](https://nodejs.org/en/download) 或以上版本。以下命令将在你的机器上全局安装。请参阅 [package page](https://www.npmjs.com/package/@hyperlane-xyz/cli)了解临时安装或从源代码构建等其他方法。

```bash
npm install -g @hyperlane-xyz/cli
```

接下来，确定本地链和远程链需要哪些自定义链配置。任何已经包含在 Hyperlane SDK 中的链都不需要链配置（但如果想覆盖默认设置，可以选择使用）。
运行以下命令查看默认 SDK 链：

```bash
hyperlane chains list
```

您可以按空格键选择链。对于需要自定义配置的链，可以使用 JSON 或 YAML 手动定义（请参阅 [配置示例](https://github.com/hyperlane-xyz/hyperlane-monorepo/blob/main/typescript/cli/examples/chain-config.yaml)），或使用以下命令创建：

```bash
hyperlane config create chain
```

现在CLI将知道如何与所有链进行交互，但它还需要知道如何配置链间安全模块（ISM）。


要创建多个ISM配置，您可以使用JSON或YAML手动定义它，请参阅此处[example config here](https://github.com/hyperlane-xyz/hyperlane-monorepo/blob/v3/typescript/cli/examples/multisig-ism.yaml))，或使用以下命令创建它：

```bash
hyperlane config create ism
```

在被询问关于多重签名类型时，选择`message id ism`。在这个指南的背景下，我们将使用 1/1 多重签名，因此选择一个阈值为 `1`，并输入您的密钥地址。

### 部署

现在我们准备使用 `deploy core` 命令部署 Hyperlane 合约。为了支付交易费用，该命令将需要来自步骤 1 的合约部署者密钥，可以通过 `HYP_KEY` 环境变量或作为命令参数提供。

```bash
hyperlane deploy core \
    --targets chain1,chain2,... \ # all the chains you want to bridge between
    --chains $CHAIN_CONFIG_FILE \  # path to chains.yaml config e.g. ./configs/chains.yaml
    --ism $MULTISIG_CONFIG_FILE \ # path to ism.yaml config e.g. ./configs/ism.yaml
    --artifacts $PREDEPLOYED_ARTIFACT_FILE \ # (optional) in case you want to reuse contracts you've already predeployed
    --out $OUT_DIR \ # (optional) deployment contract artifacts
    --key $YOUR_DEPLOYER_PRIVATE_KEY
```

### 验证

部署合同操作默认将写入 `artifacts/` 文件夹。部署程序将创建两个带时间戳的文件，即 `agent-config-{timestamp}.json` 和 `core-deployment-{timestamp}.json
`core-deployment` 文件包含按链排列的核心合约地址。
`agent-config` 文件包含下一步运行 Hyperlane 代理所需的数据。
