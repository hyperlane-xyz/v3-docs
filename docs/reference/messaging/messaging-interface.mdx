import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

import SimpleMessagingDiagram from '@site/src/diagrams/messaging-simple.md';

# Mailbox

Hyperlane的通用消息传递（GMP）接口是以一种名为邮箱（Mailbox）的智能合约的形式实现的。该合约对[message headers](#message-headers)进行编码和解码，确保全局消息的[uniqueness](#uniqueness)，并防止[replay attacks](#replay-protection)。

<SimpleMessagingDiagram/>

To [**send**](./send.mdx) 跨链消息，调用`dispatch`函数。

To [**receive**](./receive.mdx) 要实现链间消息，需要执行 `handle` 函数。

<details>
<summary>`IMailbox` Interface</summary>

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol
```

</TabItem>
</Tabs>
</details>

## 信息头

邮箱在邮件正文前加上一个包含以下字段的标头：

- `version`: 邮箱合同的版本
- `nonce`: 从给定邮箱发送的每个邮件的唯一标识符
- `origin`: 原始链的域
- `sender`: 原始链上发送方的地址
- `destination`: 目标链的地址
- `recipient`: 目标链上收件人的地址

有关消息编码的更多信息，请参阅 [`Message` library](../libraries/message.mdx)。

## 独特性

对于从给定邮箱发送的每个消息，`nonce`是一个单独递增的整数。它在每次发送消息时递增，作为其他相同消息的分隔符。

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L49
```

</TabItem>
<TabItem value="cw" label="CosmWasm">

🚧 即将到来! 🚧

</TabItem>
<TabItem value="sl" label="Sealevel">

🚧 即将到来! 🚧

</TabItem>
</Tabs>

`messageId`是一个全局唯一的消息标识符，从`dispatch`调用返回，计算为消息的`keccak256`哈希值(带headers)。

## Replay Protection

邮箱维护一个已经传递的`messageId`值的映射，以防止重播攻击。如果接收到的消息包含已经发送的`messageId`，则会拒绝该消息。

<Tabs groupId="lang">
<TabItem value="sol" label="Solidity">

```solidity file=<rootDir>/node_modules/@hyperlane-xyz/core/contracts/interfaces/IMailbox.sol#L51
```

</TabItem>
<TabItem value="cw" label="CosmWasm">

🚧 即将到来! 🚧

</TabItem>
<TabItem value="sl" label="Sealevel">

🚧 即将到来! 🚧

</TabItem>
</Tabs>
