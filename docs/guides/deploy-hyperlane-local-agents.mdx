import TerminologyPartial from "/docs/partials/deploy-hyperlane/_terminology.mdx";
import SetupKeysPartial from "/docs/partials/deploy-hyperlane/_setup-keys.mdx";
import DeployContractsPartial from "/docs/partials/deploy-hyperlane/_deploy-contracts.mdx";
import SendTestMessagesPartial from "/docs/partials/deploy-hyperlane/_send-test-messages.mdx";
import DeployWarpRoutePartial from "/docs/partials/deploy-hyperlane/_deploy-warp-route.mdx";

# Deploy Hyperlane with Local Agents

:::tip

This guide is for advanced users who have some understanding of configuring and deploying Hyperlane.

If not done so already, beginners should get started by [**deploying Hyperlane with Kurtosis agents**](/docs/deploy-hyperlane).

:::

<TerminologyPartial />

## Overview

There are six steps in this guide:

1. [<b>Set up keys</b>](#1-set-up-keys) that you will use to deploy contracts and run validators and relayers.
1. [<b>Deploy contracts</b>](#2-deploy-contracts) to the local chain and to every remote chain with which the local chain will be able to send and receive messages.
1. [<b>Run a validator</b>](#3-run-a-validator) to provide the signatures needed for the Interchain Security Modules you deployed.
1. [<b>Run a relayer</b>](#4-run-a-relayer) to send and receive messages between the chains you deployed contracts to.
1. [<b>Send a test message</b>](#5-send-test-messages) to confirm that your relayer is able to deliver messages to and from each pair of chains.
1. [<b>Deploy a Warp Route</b>](#6-optional-deploy-a-warp-route) to send token value, not just messages, across chains.

## Getting Started

## 1. Set up keys

<SetupKeysPartial />

## 2. Deploy contracts

<DeployContractsPartial />

## 3. Run a validator

Follow the [Validators guide](/docs/operate/validators/run-validators) to run a validator for the Mailbox on your local chain. This validator will provide the security for messages sent _from_ your chain to remote chains.

You should have already set up your validator keys in [step 1](#1-set-up-keys), so you can skip that part of the guide.

:::info

Make sure your validator matches the address provided when setting up your MultisigIsmConfig. Otherwise, the Multisig ISM you deployed in the previous step will not be able to verify messages sent from your chain.

:::

Set the `CONFIG_FILES` environment variable to the path of the agent config generated in the [deploy contracts](#2-deploy-contracts) step. For example:
```bash
export CONFIG_FILES=/path/to/configs/agent-config-{timestamp}.json
```

If you are using Docker, you will need to mount the file into the container.

## 4. Run a relayer

Follow the [Relayer guide](/docs/operate/relayer/run-relayer) to run a relayer delivering interchain messages sent between the local and remote chains. You should have already set up your relayer keys in [step 1](#1-set-up-keys), so you can skip that part of the guide.

Remember to set the `--relayChains` argument or `HYP_RELAYCHAINS` environment variable appropriately.

Set the `CONFIG_FILES` environment variable to the path of the agent config generated in the [deploy contracts](#2-deploy-contracts) step. For example:
```bash
export CONFIG_FILES=/path/to/configs/agent-config-{timestamp}.json
```

If you are using Docker, you will need to mount the file into the container.

## 5. Send test messages

<SendTestMessagesPartial />

## 6. (Optional) Deploy a Warp Route

<DeployWarpRoutePartial />
