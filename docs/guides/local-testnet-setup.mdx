# Hyperlane Local Setup Guide: Sending Messages between Anvil Chains

This guide walks you through sending interchain messages between two local Anvil chains using the Hyperlane CLI.

## Prerequisites

- **[Hyperlane CLI](https://docs.hyperlane.xyz/docs/reference/cli):** Ensure you have the latest version of the Hyperlane CLI installed. `npm install -g @hyperlane-xyz/cli`

- **[Anvil (foundry)](https://book.getfoundry.sh/anvil/):** Installed to run local chains. Install it via
  ```bash
  curl -L https://foundry.paradigm.xyz | bash
  foundryup
  ```
- **Node.js** (v18 or later)
- **Deployer Wallet Private Key**: You need a funded wallet for deploying contracts. This will be used as the HYP_KEY.
  ```bash
  export HYP_KEY=<YOUR_PRIVATE_KEY>
  ```

## Step-by-Step Guide

### 1. Environment Setup: Create a working directory for the Hyperlane configuration:

```bash
mkdir hyperlane-local-test && cd hyperlane-local-test
```

### 2. Start Two Distinct Anvil Nodes

We will run two Anvil nodes with unique chain IDs.

- On a first terminal, start the first Anvil node:

  ```bash
  anvil --port 8545 --chain-id 31337
  ```

  - Runs on `http://localhost:8545`.
  - Chain ID: `31337`.

- In a new terminal, start the second Anvil node: :

  ```bash
  anvil --port 8546 --chain-id 31338
  ```

  - Runs on `http://localhost:8546`.
  - Chain ID: `31338`.

### 3. Initialize the Hyperlane Registry

On a new termial, use the Hyperlane CLI to create a custom chain config for both your chains:

```bash
hyperlane registry init
```

Follow the prompts to set up anvilchain1 and anvilchain2. The CLI will ask you for the details of your chains including chainId and RPC URLs.

Example metadata:

- **anvilchain1**

```yaml
chainId: 31337
displayName: Anvilchain1
domainId: 31337
isTestnet: true
name: anvilchain1
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8545
```

- **anvilchain2**

```yaml
chainId: 31338
displayName: Anvilchain2
domainId: 31338
isTestnet: true
name: anvilchain2
nativeToken:
  decimals: 18
  name: ETH
  symbol: ETH
protocol: ethereum
rpcUrls:
  - http: http://localhost:8546
```

This will create `metadata.yaml` files under `$HOME/.hyperlane/chains/anvilchain1` and `$HOME/.hyperlane/chains/anvilchain2`.

### 4. Deploy Core Contracts

We'll configure and deploy Hyperlane core contracts to the custom chains.

:::tip
You'll need the deployer wallet private key to deploy the core contracts. You can use `export HYP_KEY='<YOUR_PRIVATE_KEY>'` to set the private key as an environment variable.
:::

```bash
hyperlane core init
```

The deployment configuration will be saved to `./configs/core-config.yaml`.

Next, deploy the core contracts for both chains:

```bash
hyperlane core deploy
```

Follow the prompts to select `anvilchain1`. The CLI will deploy Mailbox, Interchain Security Modules (ISMs), and other required contracts. Repeat the process for `anvilchain2`.

Once complete, youâ€™ll find `addresses.yaml` in `$HOME/.hyperlane/chains/anvilchain1` and `$HOME/.hyperlane/chains/anvilchain2`, with the deployed contract addresses.

:::tip
You should be able to see the messages on your terminals running the local chains.
:::

### 5. Send a Test Message

Use the Hyperlane CLI to send a message from `anvilchain1` to `anvilchain2`.

```bash
hyperlane send message --relay
```

The CLI will prompt you to provide the origin chain (`anvilchain1`) and the destination chain (`anvilchain2`).

:::tip

For local testing: The `--relay` flag automatically relays the message to the destination chain.

:::

Review the logs on `anvilchain1` and `anvilchain2` to confirm the message was sent and received.
